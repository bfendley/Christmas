<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Holiday Present Order Wheel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #020617;
      --bg-soft: #020617;
      --card: rgba(15, 23, 42, 0.9);
      --card-soft: rgba(15, 23, 42, 0.85);
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.35);
      --accent-strong: #16a34a;
      --accent-secondary: #ef4444;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.3);
      --shadow-glow: 0 0 40px rgba(34, 197, 94, 0.35);
      --button-bg: rgba(15, 118, 110, 0.6);
      --button-hover: rgba(34, 197, 94, 0.8);
      --wheel-bg: radial-gradient(circle at 30% 30%, #1f2937 0, #020617 70%);
    }

    body.theme-christmas {
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.35);
      --accent-strong: #16a34a;
      --accent-secondary: #ef4444;
      --button-bg: rgba(34, 197, 94, 0.12);
      --button-hover: rgba(248, 250, 252, 0.06);
      --shadow-glow: 0 0 40px rgba(248, 250, 252, 0.3);
      --wheel-bg: radial-gradient(circle at 20% 20%, #14532d 0, #020617 70%);
    }

    body.theme-hanukkah {
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.35);
      --accent-strong: #0ea5e9;
      --accent-secondary: #e5e7eb;
      --button-bg: rgba(37, 99, 235, 0.18);
      --button-hover: rgba(191, 219, 254, 0.15);
      --shadow-glow: 0 0 40px rgba(56, 189, 248, 0.4);
      --wheel-bg: radial-gradient(circle at 20% 20%, #1e3a8a 0, #020617 70%);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 1.5rem 1rem 2rem;
    }

    .glow-orbit {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 15% 10%, rgba(248, 250, 252, 0.08), transparent 55%),
        radial-gradient(circle at 85% 90%, rgba(56, 189, 248, 0.12), transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.7;
      z-index: -2;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      border-radius: 1.5rem;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow:
        0 24px 80px rgba(15, 23, 42, 0.9),
        var(--shadow-glow);
      padding: 1.4rem 1.4rem 1.6rem;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(20px);
    }

    .app-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 0%, var(--accent-soft), transparent 55%);
      opacity: 0.25;
      pointer-events: none;
      z-index: -1;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      margin-bottom: 1.3rem;
    }

    .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    h1 {
      font-size: 1.4rem;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
    }

    h1 span.icon {
      font-size: 1.4rem;
      filter: drop-shadow(0 0 10px rgba(248, 250, 252, 0.85));
    }

    h1 span.accent-pill {
      font-size: 0.7rem;
      padding: 0.2rem 0.75rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-soft);
      text-transform: none;
    }

    .theme-toggle {
      display: inline-flex;
      padding: 0.18rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      backdrop-filter: blur(14px);
      align-items: center;
      gap: 0.2rem;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.9);
    }

    .theme-toggle button {
      border: none;
      padding: 0.4rem 0.75rem;
      border-radius: 999px;
      background: transparent;
      color: var(--text-soft);
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      cursor: pointer;
      transition: all 0.18s ease-out;
      white-space: nowrap;
    }

    .theme-toggle button span.emoji {
      font-size: 1rem;
    }

    .theme-toggle button.active {
      background: radial-gradient(circle at top, var(--accent-soft), transparent 80%);
      color: #f9fafb;
      box-shadow:
        0 0 0 1px rgba(248, 250, 252, 0.16),
        0 0 18px rgba(15, 23, 42, 0.85);
    }

    .subtitle {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .subtitle-pill {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      font-size: 0.7rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .content-grid {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    @media (min-width: 900px) {
      .content-grid {
        flex-direction: row;
      }
      .main-panel {
        flex: 1.4;
      }
      .rules-panel {
        flex: 0.9;
      }
    }

    .panel {
      background: linear-gradient(150deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
      border-radius: 1.2rem;
      padding: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.85);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(248, 250, 252, 0.03);
      opacity: 0.8;
      pointer-events: none;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.7rem;
    }

    .panel-header h2 {
      font-size: 0.9rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .panel-header h2 span.dot {
      width: 0.35rem;
      height: 0.35rem;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px var(--accent-soft);
    }

    .hint-text {
      font-size: 0.68rem;
      color: var(--text-soft);
      opacity: 0.9;
    }

    /* Wheel area */

    .wheel-section {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .wheel-shell {
      background: var(--wheel-bg);
      border-radius: 1rem;
      padding: 0.7rem;
      border: 1px solid rgba(15, 23, 42, 0.9);
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      overflow: hidden;
    }

    .wheel-shell::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 30% 0%, rgba(248, 250, 252, 0.14), transparent 60%),
        radial-gradient(circle at 70% 100%, rgba(15, 23, 42, 0.9), transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.9;
      pointer-events: none;
      z-index: -1;
    }

    .wheel-container {
      position: relative;
      width: min(280px, 80vw);
      height: min(280px, 80vw);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    canvas#wheel {
      width: 100%;
      height: 100%;
      border-radius: 999px;
      box-shadow:
        0 0 0 2px rgba(15, 23, 42, 0.9),
        0 0 0 4px rgba(15, 23, 42, 0.9),
        0 24px 35px rgba(15, 23, 42, 0.9);
      background: radial-gradient(circle at 50% 30%, rgba(15, 23, 42, 0.5), #020617);
    }

    .wheel-pointer {
      position: absolute;
      top: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 20px solid #f9fafb;
      filter: drop-shadow(0 0 10px rgba(15, 23, 42, 0.9));
      z-index: 5;
    }

    .wheel-center-cap {
      position: absolute;
      width: 70px;
      height: 70px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #f9fafb, #e5e7eb);
      box-shadow:
        0 4px 0 rgba(148, 163, 184, 0.7),
        0 0 26px rgba(248, 250, 252, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.7rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #111827;
    }

    .wheel-center-cap span {
      display: inline-block;
      text-align: center;
    }

    .wheel-actions {
      display: flex;
      justify-content: center;
      gap: 0.6rem;
      flex-wrap: wrap;
    }

    .btn {
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: var(--button-bg);
      color: var(--text-main);
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      cursor: pointer;
      backdrop-filter: blur(14px);
      transition: all 0.18s ease-out;
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.85);
      white-space: nowrap;
    }

    .btn span.icon {
      font-size: 0.95rem;
    }

    .btn.primary {
      border-color: rgba(248, 250, 252, 0.8);
      background: linear-gradient(135deg, var(--accent-strong), var(--accent-secondary));
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 18px 40px rgba(15, 23, 42, 0.95),
        0 0 30px var(--accent-soft);
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .btn.primary:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn:hover:not(:disabled) {
      background: var(--button-hover);
      transform: translateY(-1px);
    }

    .btn.primary:hover:not(:disabled) {
      filter: brightness(1.05);
      transform: translateY(-1px) scale(1.01);
    }

    .status-bar {
      margin-top: 0.4rem;
      font-size: 0.7rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.25rem;
    }

    .status-bar span.highlight {
      color: #f9fafb;
      font-weight: 500;
    }

    .status-chip {
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.68rem;
    }

    /* Names & settings */

    .names-card {
      margin-top: 0.8rem;
      padding: 0.7rem 0.7rem 0.6rem;
      border-radius: 0.9rem;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), #020617);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .names-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
    }

    .input-pill {
      flex: 1;
      min-width: 0;
      display: flex;
      align-items: center;
      padding: 0.25rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .input-pill input {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-size: 0.78rem;
      padding: 0.15rem 0.25rem;
    }

    .input-pill input::placeholder {
      color: rgba(148, 163, 184, 0.7);
    }

    .chip-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-soft);
    }

    .names-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .name-pill {
      border-radius: 999px;
      padding: 0.25rem 0.6rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(75, 85, 99, 0.9);
      font-size: 0.72rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      color: var(--text-main);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
    }

    .name-pill.inactive {
      opacity: 0.4;
      border-style: dashed;
    }

    .name-pill .hits {
      font-size: 0.68rem;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--accent);
    }

    .name-pill button.remove {
      border: none;
      background: transparent;
      padding: 0;
      margin: 0;
      cursor: pointer;
      font-size: 0.85rem;
      color: rgba(148, 163, 184, 0.9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.1rem;
      height: 1.1rem;
      border-radius: 999px;
      transition: all 0.15s ease;
    }

    .name-pill button.remove:hover {
      background: rgba(248, 113, 113, 0.15);
      color: #fecaca;
    }

    .settings-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .settings-row label {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .settings-row input[type="number"] {
      width: 3rem;
      padding: 0.15rem 0.25rem;
      border-radius: 0.6rem;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 0.72rem;
      outline: none;
    }

    .settings-row .hint {
      opacity: 0.8;
    }

    /* Rules */

    .rules-panel {
      background: radial-gradient(circle at top, rgba(15, 23, 42, 1), #020617);
    }

    .rules-list {
      margin: 0.4rem 0 0.6rem;
      padding-left: 1.1rem;
      font-size: 0.75rem;
      color: var(--text-soft);
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .rules-list li {
      line-height: 1.4;
    }

    .rules-tagline {
      margin-top: 0.5rem;
      font-size: 0.7rem;
      color: var(--text-soft);
      padding: 0.5rem 0.6rem;
      border-radius: 0.7rem;
      border: 1px dashed rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), #020617);
    }

    .rules-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.6rem;
    }

    .rules-meta span {
      font-size: 0.68rem;
      color: var(--text-soft);
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.95);
    }

    .rules-footer {
      margin-top: 0.6rem;
      font-size: 0.68rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 0.3rem;
      flex-wrap: wrap;
      opacity: 0.9;
    }

    .rules-footer strong {
      color: #e5e7eb;
    }

    @media (max-width: 480px) {
      .app-shell {
        padding: 1rem;
        border-radius: 1.1rem;
      }
      h1 {
        font-size: 1.2rem;
      }
      .panel {
        padding: 0.85rem;
      }
      .wheel-container {
        width: min(250px, 80vw);
        height: min(250px, 80vw);
      }
    }
  </style>
</head>
<body class="theme-christmas">
<div class="glow-orbit"></div>

<div class="app-shell">
  <header>
    <div class="title-row">
      <h1>
        <span class="icon">üéÅ</span>
        Holiday Present Order
        <span class="accent-pill">Prototype ¬∑ Spin to decide the opening order</span>
      </h1>
      <div class="theme-toggle" aria-label="Holiday theme switch">
        <button id="btnThemeChristmas" class="active" type="button">
          <span class="emoji">üéÑ</span>
          Christmas
        </button>
        <button id="btnThemeHanukkah" type="button">
          <span class="emoji">üïé</span>
          Hanukkah
        </button>
      </div>
    </div>
    <div class="subtitle">
      <span>Tap in everyone‚Äôs name, pick your holiday vibe, and let the wheel decide who opens next.</span>
      <span class="subtitle-pill">Mobile-ready ¬∑ Static ¬∑ GitHub Pages friendly</span>
    </div>
  </header>

  <main class="content-grid">
    <!-- Main / Wheel panel -->
    <section class="panel main-panel">
      <div class="panel-header">
        <h2><span class="dot"></span> Spin Wheel</h2>
        <div class="hint-text">Tip: add at least 2 names to start spinning.</div>
      </div>

      <div class="wheel-section">
        <div class="wheel-shell">
          <div class="wheel-container">
            <canvas id="wheel" width="520" height="520"></canvas>
            <div class="wheel-pointer"></div>
            <div class="wheel-center-cap">
              <span id="centerLabel">Ready<br>to Spin</span>
            </div>
          </div>
          <div class="wheel-actions">
            <button class="btn primary" id="btnSpin">
              <span class="icon">‚ú®</span>
              Spin Order
            </button>
            <button class="btn" id="btnResetHits">
              <span class="icon">üîÑ</span>
              Reset Counts
            </button>
            <button class="btn" id="btnClearAll">
              <span class="icon">üßπ</span>
              Clear Names
            </button>
          </div>
          <div class="status-bar">
            <span id="statusText">Waiting for names‚Ä¶</span>
            <span class="status-chip" id="statusStats">0 players ¬∑ max 3 gifts</span>
          </div>
        </div>

        <div class="names-card">
          <div class="names-row">
            <div class="chip-label">Players</div>
            <div class="input-pill">
              <input
                id="nameInput"
                type="text"
                autocomplete="off"
                placeholder="Type a name and press Enter"
              />
            </div>
            <button class="btn" id="btnAddName" type="button">
              <span class="icon">‚ûï</span>
              Add
            </button>
          </div>

          <div class="names-list" id="namesList"></div>

          <div class="settings-row">
            <label>
              Max gifts per person:
              <input
                type="number"
                id="maxHitsInput"
                min="1"
                value="3"
              />
            </label>
            <span class="hint">Once someone hits this, they‚Äôre automatically skipped.</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Rules panel -->
    <aside class="panel rules-panel">
      <div class="panel-header">
        <h2><span class="dot"></span> House Rules</h2>
        <div class="hint-text">Customize these later ‚Äî this is your family‚Äôs chaos generator.</div>
      </div>

      <ul class="rules-list">
        <li><strong>One spin = one gift opener.</strong> Whoever the wheel lands on opens the next present.</li>
        <li><strong>Triple land = temporary skip.</strong> When a person is chosen up to the max gifts limit, their name dims and they‚Äôre skipped for the rest of the round.</li>
        <li><strong>Present limits.</strong> Adjust ‚ÄúMax gifts per person‚Äù to keep things fair ‚Äî default is 3 per person.</li>
        <li><strong>All maxed out?</strong> If everyone hits the limit, you‚Äôll get a reminder to reset counts or add new names.</li>
        <li><strong>Theme flip.</strong> Use the switch up top to swap between Christmas red/green and Hanukkah blue/white glow.</li>
      </ul>

      <div class="rules-tagline">
        You can tweak these rules later (bonus rounds, steal-a-present spins, wildcard ‚Äúskip a turn‚Äù slots, etc.).
        For now, it‚Äôs a clean, fair order-decider the whole crew can see on a phone or TV.
      </div>

      <div class="rules-meta">
        <span>üì± Built for phones & tablets</span>
        <span>üåê Static, GitHub-Pages ready</span>
        <span>‚ú® Theme-reactive wheel colors</span>
      </div>

      <div class="rules-footer">
        <span><strong>Pro tip:</strong> Mirror this page to the TV and let everyone yell ‚ÄúSpin!‚Äù together.</span>
        <span>v0.1 ¬∑ Prototype ¬∑ No data saved</span>
      </div>
    </aside>
  </main>
</div>

<script>
  // ---- State ----
  let players = []; // { id, name, hits, active }
  let rotation = 0; // radians
  let spinning = false;
  let lastWinnerId = null;

  const wheelCanvas = document.getElementById("wheel");
  const ctx = wheelCanvas.getContext("2d");

  const centerLabel = document.getElementById("centerLabel");
  const btnSpin = document.getElementById("btnSpin");
  const btnResetHits = document.getElementById("btnResetHits");
  const btnClearAll = document.getElementById("btnClearAll");
  const nameInput = document.getElementById("nameInput");
  const btnAddName = document.getElementById("btnAddName");
  const namesList = document.getElementById("namesList");
  const statusText = document.getElementById("statusText");
  const statusStats = document.getElementById("statusStats");
  const maxHitsInput = document.getElementById("maxHitsInput");

  const btnThemeChristmas = document.getElementById("btnThemeChristmas");
  const btnThemeHanukkah = document.getElementById("btnThemeHanukkah");

  function getMaxHits() {
    const val = parseInt(maxHitsInput.value, 10);
    return isNaN(val) || val <= 0 ? null : val;
  }

  function addPlayer(name) {
    const trimmed = name.trim();
    if (!trimmed) return;
    const exists = players.some(
      (p) => p.name.toLowerCase() === trimmed.toLowerCase()
    );
    if (exists) {
      nameInput.value = "";
      flashStatus("That name is already on the wheel.", true);
      return;
    }
    players.push({
      id: Date.now() + "-" + Math.random().toString(16).slice(2),
      name: trimmed,
      hits: 0,
      active: true,
    });
    nameInput.value = "";
    refreshUI();
  }

  function removePlayer(id) {
    players = players.filter((p) => p.id !== id);
    if (players.length === 0) {
      lastWinnerId = null;
    }
    refreshUI();
  }

  function resetHits() {
    players.forEach((p) => {
      p.hits = 0;
      p.active = true;
    });
    lastWinnerId = null;
    refreshUI();
    flashStatus("All counts reset. Fresh chaos unlocked.");
  }

  function clearAll() {
    players = [];
    lastWinnerId = null;
    refreshUI();
    flashStatus("Cleared all names. Add players to begin.");
  }

  function applyMaxHitsRule() {
    const max = getMaxHits();
    if (!max) {
      players.forEach((p) => (p.active = true));
      return;
    }
    players.forEach((p) => {
      if (p.hits >= max) {
        p.active = false;
      }
    });
  }

  function getActivePlayers() {
    return players.filter((p) => p.active);
  }

  function flashStatus(msg, isWarning = false) {
    statusText.textContent = msg;
    if (isWarning) {
      statusText.style.color = "#fecaca";
    } else {
      statusText.style.color = "";
    }
  }

  function refreshUI() {
    applyMaxHitsRule();
    renderNamesList();
    drawWheel();
    updateStatus();
  }

  function renderNamesList() {
    namesList.innerHTML = "";
    if (players.length === 0) {
      const ghost = document.createElement("div");
      ghost.style.fontSize = "0.72rem";
      ghost.style.color = "var(--text-soft)";
      ghost.textContent = "No names yet ‚Äî start by adding everyone getting a present.";
      namesList.appendChild(ghost);
      return;
    }
    players.forEach((p) => {
      const pill = document.createElement("div");
      pill.className = "name-pill" + (p.active ? "" : " inactive");

      const nameSpan = document.createElement("span");
      nameSpan.textContent = p.name;

      const hitsSpan = document.createElement("span");
      hitsSpan.className = "hits";
      hitsSpan.textContent = p.hits + " üéÅ";

      const btnRemove = document.createElement("button");
      btnRemove.className = "remove";
      btnRemove.type = "button";
      btnRemove.innerHTML = "√ó";
      btnRemove.title = "Remove";

      btnRemove.addEventListener("click", () => removePlayer(p.id));

      pill.appendChild(nameSpan);
      pill.appendChild(hitsSpan);
      pill.appendChild(btnRemove);

      namesList.appendChild(pill);
    });
  }

  function updateStatus() {
    const active = getActivePlayers();
    const max = getMaxHits();
    const total = players.length;
    statusStats.textContent =
      total +
      " player" +
      (total === 1 ? "" : "s") +
      " ¬∑ max " +
      (max || "‚àû") +
      " gifts";
    if (total === 0) {
      statusText.textContent = "Waiting for names‚Ä¶";
      btnSpin.disabled = true;
      return;
    }
    if (active.length === 0) {
      statusText.textContent =
        "Everyone has hit the gift limit. Reset counts or increase the max.";
      statusText.style.color = "#fee2e2";
      btnSpin.disabled = true;
      return;
    }
    if (active.length === 1) {
      statusText.textContent =
        "Only one active player ‚Äî they‚Äôll keep opening until they reach the limit.";
      statusText.style.color = "";
      btnSpin.disabled = false;
      return;
    }
    statusText.textContent = "Ready. Tap Spin whenever your crew is set.";
    statusText.style.color = "";
    btnSpin.disabled = false;
  }

  // ---- Wheel Drawing ----
  function drawWheel() {
    const width = wheelCanvas.width;
    const height = wheelCanvas.height;
    const cx = width / 2;
    const cy = height / 2;
    const radius = Math.min(width, height) / 2 - 20;

    ctx.clearRect(0, 0, width, height);

    const activePlayers = getActivePlayers();
    const sliceCount = activePlayers.length || players.length;
    const sliceAngle = sliceCount ? (Math.PI * 2) / sliceCount : Math.PI * 2;

    if (!players.length) {
      // Empty wheel placeholder
      ctx.save();
      ctx.translate(cx, cy);
      const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, radius);
      gradient.addColorStop(0, "rgba(31, 41, 55, 0.9)");
      gradient.addColorStop(1, "rgba(15, 23, 42, 1)");
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(0, 0, radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
      return;
    }

    const paletteChristmas = [
      "#22c55e",
      "#ef4444",
      "#16a34a",
      "#f97316",
      "#84cc16",
      "#facc15",
    ];
    const paletteHanukkah = [
      "#38bdf8",
      "#e5e7eb",
      "#0ea5e9",
      "#93c5fd",
      "#1d4ed8",
      "#bfdbfe",
    ];

    const useChristmas = document.body.classList.contains("theme-christmas");
    const palette = useChristmas ? paletteChristmas : paletteHanukkah;

    ctx.save();
    ctx.translate(cx, cy);

    for (let i = 0; i < sliceCount; i++) {
      const startAngle = rotation + i * sliceAngle;
      const endAngle = startAngle + sliceAngle;

      const color = palette[i % palette.length];
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.arc(0, 0, radius, startAngle, endAngle);
      ctx.closePath();

      const gradient = ctx.createRadialGradient(0, 0, radius * 0.2, 0, 0, radius);
      gradient.addColorStop(0, "rgba(15, 23, 42, 0.9)");
      gradient.addColorStop(0.6, color);
      gradient.addColorStop(1, "rgba(15, 23, 42, 0.9)");

      ctx.fillStyle = gradient;
      ctx.fill();

      ctx.strokeStyle = "rgba(15, 23, 42, 0.9)";
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    // Labels
    ctx.fillStyle = "#e5e7eb";
    ctx.font = "14px system-ui, sans-serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    for (let i = 0; i < sliceCount; i++) {
      const midAngle = rotation + i * sliceAngle + sliceAngle / 2;
      const labelRadius = radius * 0.65;
      const x = Math.cos(midAngle) * labelRadius;
      const y = Math.sin(midAngle) * labelRadius;

      const player = activePlayers[i] || players[i];
      const displayName = player ? player.name : "?";

      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(midAngle);
      ctx.fillText(displayName, 0, 0);
      ctx.restore();
    }

    // Inner ring
    ctx.beginPath();
    ctx.arc(0, 0, radius * 0.35, 0, Math.PI * 2);
    ctx.strokeStyle = "rgba(15,23,42,0.95)";
    ctx.lineWidth = 14;
    ctx.stroke();

    ctx.restore();
  }

  function spinWheel() {
    if (spinning) return;
    const activePlayers = getActivePlayers();
    if (activePlayers.length === 0) {
      flashStatus(
        "Everyone has reached the gift limit. Reset counts or raise the limit.",
        true
      );
      return;
    }
    spinning = true;
    btnSpin.disabled = true;

    const sliceCount = activePlayers.length;
    const sliceAngle = (Math.PI * 2) / sliceCount;

    const extraTurns = 4 + Math.random() * 2;
    const randomSliceOffset = Math.floor(Math.random() * sliceCount);
    const targetAngle =
      rotation +
      extraTurns * Math.PI * 2 -
      randomSliceOffset * sliceAngle -
      sliceAngle / 2 +
      Math.PI / 2;

    const startRotation = rotation;
    const duration = 2600 + Math.random() * 700;
    const startTime = performance.now();

    function animate(now) {
      const elapsed = now - startTime;
      const t = Math.min(elapsed / duration, 1);
      const eased = 1 - Math.pow(1 - t, 3); // cubic ease-out

      rotation = startRotation + (targetAngle - startRotation) * eased;
      rotation = rotation % (Math.PI * 2);

      drawWheel();

      if (t < 1) {
        requestAnimationFrame(animate);
      } else {
        spinning = false;
        resolveWinner();
      }
    }

    requestAnimationFrame(animate);
  }

  function resolveWinner() {
    const activePlayers = getActivePlayers();
    if (activePlayers.length === 0) {
      btnSpin.disabled = false;
      return;
    }

    const sliceCount = activePlayers.length;
    const sliceAngle = (Math.PI * 2) / sliceCount;

    const pointerAngle = -Math.PI / 2;
    let normalized = (pointerAngle - rotation) % (Math.PI * 2);
    if (normalized < 0) normalized += Math.PI * 2;

    const index = Math.floor(normalized / sliceAngle);
    const winner = activePlayers[index];

    if (!winner) {
      btnSpin.disabled = false;
      return;
    }

    // Update hits and apply rules
    winner.hits += 1;
    lastWinnerId = winner.id;
    applyMaxHitsRule();

    let msg = winner.name + " opens the next present!";
    const max = getMaxHits();
    if (max && winner.hits >= max) {
      msg += " (They‚Äôve reached the gift limit and will be skipped now.)";
    }

    centerLabel.textContent = winner.name;
    flashStatus(msg);
    refreshUI();
    btnSpin.disabled = false;
  }

  // ---- Theme Toggle ----
  function setTheme(theme) {
    if (theme === "christmas") {
      document.body.classList.add("theme-christmas");
      document.body.classList.remove("theme-hanukkah");
      btnThemeChristmas.classList.add("active");
      btnThemeHanukkah.classList.remove("active");
    } else {
      document.body.classList.add("theme-hanukkah");
      document.body.classList.remove("theme-christmas");
      btnThemeHanukkah.classList.add("active");
      btnThemeChristmas.classList.remove("active");
    }
    drawWheel();
  }

  // ---- Event Listeners ----
  btnSpin.addEventListener("click", spinWheel);
  btnResetHits.addEventListener("click", resetHits);
  btnClearAll.addEventListener("click", clearAll);

  btnAddName.addEventListener("click", () => {
    addPlayer(nameInput.value);
  });

  nameInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      addPlayer(nameInput.value);
    }
  });

  maxHitsInput.addEventListener("change", () => {
    refreshUI();
  });

  btnThemeChristmas.addEventListener("click", () => setTheme("christmas"));
  btnThemeHanukkah.addEventListener("click", () => setTheme("hanukkah"));

  // Initial draw
  drawWheel();
  updateStatus();
</script>
</body>
</html>
